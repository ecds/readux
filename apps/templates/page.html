{% extends "base.html" %}
{% load static i18n %}
{% block extra_css %}
<link href="{% static 'mirador/css/mirador-combined.css' %}" rel="stylesheet">
{% endblock extra_css %}

{% block content %}

<!-- 
<p class="breadcrumbs"><a href="/">Home</a> > Collection{{Collections|length|pluralize}}: {% for col in volume.collections.all %}<a class="nav-link" href="{% url 'collection' col.pid %}">{{ col.label }}</a> {% if not forloop.last %}| {% endif %} {% endfor %}> Work: <a href="">{{volume.label}}</a></p>
 -->
<h1 class='uk-text-truncate'>
  {{volume.label}}
</h1>
{% endblock content %}
{% block viewer %}
  <div class='uk-flex-center' uk-grid>
    <div class='uk-width-3-4'>
      <div  id='viewer'></div>

    </div>
    <div class='uk-width-1-4'>
      <div class='uk-padding'>
        {% if page.pid is not None %}
  <form class="uk-search uk-search-default" action="{% url 'page' volume.pid page.pid %}" method="get" accept-charset="utf-8">
      <!-- <span uk-search-icon></span>&nbsp; -->
      <input class="form-control mr-sm-2" type="text" placeholder="Search this volume" aria-label="Search" name="q">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
  </form>
        {% else %}
  <form class="uk-search uk-search-default" action="{% url 'volumeall' volume.pid %}" method="get" accept-charset="utf-8">
      <!-- <span uk-search-icon></span>&nbsp; -->
      <input class="form-control mr-sm-2" type="text" placeholder="Search this volume" aria-label="Search" name="q">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
  </form>
        {% endif %}
        <p></p>
      <div class='uk-padding readux-metadata'>
        <b>Author:</b> {{ volume.author }}
        <br />
        <b>Publication Date:</b> {{ volume.published_date }}
        <br />{% for col in volume.collections.all %}
        <b>Collection:</b> <a class="nav-link" href="{% url 'collection' col.pid %}">{{ col.label }}</a>
        <br />{% endfor %}
        <b>Publisher:</b> {{ volume.published_city }} : {{ volume.publisher }}
        <ul>
          {% for note in volume.note_set.all %}
          <li>
            {{ note.label }}
          </li>
          {% endfor %}
        </ul>
        <br />
        <b>Manifest URL:</b> <a href="https://{{ request.META.HTTP_HOST }}{% url 'ManifestRender' 'v2' volume.pid %}" target="_blank">https://{{ request.META.HTTP_HOST }}{% url 'ManifestRender' 'v2' volume.pid %}</a>
        <br />{% for col in volume.collections.all %}
        <b>Collection Manifest URL:</b> <a href="https://{{ request.META.HTTP_HOST }}{% url 'CollectionRender' 'v2' col.pid %}" target="_blank">https://{{ request.META.HTTP_HOST }}{% url 'CollectionRender' 'v2' col.pid %}</a>
        <br />{% endfor %}
        <br />
        <b>View PDF:</b> <a href="{{volume.pdf}}" target="_blank">Click to view volume PDF</a>
        <br />
        <br />
        <b>Export Citation:</b> <a href="https://{{ request.META.HTTP_HOST }}{% url 'ris' volume.pid %}" target="_blank">Click to download RIS file</a>
        <br />
        <b>Stable volume URL:</b> <a href="https://{{ request.META.HTTP_HOST }}{% url 'volume' volume.pid %}/page/all" target="_blank">https://{{ request.META.HTTP_HOST }}{% url 'volume' volume.pid %}/page/all</a>
        <br />
        {% if page.pid is not None %}
        <b>Canvas URL:</b> <span class="link" id="myLink"></span>
        <br />
        <b>Stable page URL:</b> <span class="link" id="mySpan"></span>
        <br />{% if user_annotation_count > 0 %}
        <b>My annotations (this manifest):</b> {{ user_annotation_count }}
        <br />
        <b>My annotations (this page):</b> {{ user_annotation_page_count }}
        <br />{% endif %}
        {% endif %}
<div>
{% if qs1 %}<hr />
<p><strong>The results of the search query in text: {{ request.GET.q }}</strong></p>
<ul>{% for answer in qs1 %}{% if answer.canvas.manifest.label in volume.label %}
<li><a href="https://{{ request.META.HTTP_HOST }}{% url 'volume' volume.pid %}/page/{{ answer.canvas.pid }}" target="_blank">Canvas {{ answer.canvas.position }}</a></li>
{% endif %}{% endfor %}</ul>
{% elif request.GET.q  and not qs1 %}<hr /><p>No results in the text in this volume</p>{% endif %}
{% if qs2 %}
<p><strong>The results of the search query in your annotations: {{ request.GET.q }}</strong></p>
<ul>{% for answer in qs2 %}{% if answer.canvas.manifest.label in volume.label %}
<li><a href="https://{{ request.META.HTTP_HOST }}{% url 'volume' volume.pid %}/page/{{ answer.canvas.pid }}" target="_blank">Canvas {{ answer.canvas.position }}</a></li>
{% endif %}{% endfor %}</ul>
{% elif request.GET.q  and not qs2 %}<p>No results in your annotations in this volume</p>
{% endif %}
</div>
        {% if user_annotation_count > 0 %}<hr />
        <form action="{% url 'export' volume.pid %}" class="button_to" method="GET"><div><input type="submit" value="Export" title="Export in a variety of formats"/>{% csrf_token %}</div></form>
        {% endif %}
        {% if page.pid is not None %}
<!-- 
        <p id="test"></p>
        <a class="facebook" href='http://www.facebook.com/sharer.php?s=100&p[url]=http://{{ request.META.HTTP_HOST }}{{ request.path }}&p[images][0]{{ page.IIIF_IMAGE_SERVER_BASE }}{{ page.pid }}/full/600,/0/default.jpg' target="_blank">
        <img src="https://www.cabq.gov/culturalservices/biopark/images/share-on-facebook.png/@@images/image.png" title="Facebook" alt="Facebook" ></a>
 -->
        {% endif %}
      </div>

      <!-- start ocr el -->
      <div id='ocr' style='opacity: 0;'>

  </div>
      <!-- end ocr el -->
    </div>
  </div>
{% endblock viewer %}
{% block extra_javascript %}
<script src="{% static 'mirador/mirador.js' %}"></script>
<script type="text/javascript">
  $(function() {
    Mirador({
      "id": "viewer",
      "mainMenuSettings" : {
        'show' : false,
        'buttons' : {
          info: false
        }
      },
      "layout": "1x1",
      "data": [
        {
          "manifestUri": "https://{{ request.META.HTTP_HOST }}/iiif/v2/{{ volume.pid }}/manifest", "location": "Emory University"
        }
      ],
      'windowSettings' : {
        "overlay" : true,
        "canvasControls": {}
      },
      "windowObjects": [{
        loadedManifest: "https://{{ request.META.HTTP_HOST }}/iiif/v2/{{ volume.pid }}/manifest",
        annotationLayer: true,
        annotationCreation: true,
        annotationState: 'annoOncreateOn',{% if page.pid is not None %}
        canvasID: 'https://{{ request.META.HTTP_HOST }}/iiif/{{ page.manifest.pid }}/canvas/{{ page.pid }}',{% endif %}
        displayLayout: false,
        sidePanel: false,
        {% if "/page/all" in request.get_full_path %}
        canvasID: 'https://{{ request.META.HTTP_HOST }}/iiif/{{ volume.pid }}/canvas/{{ volume.canvas_set.pid.first }}',
        viewType: "ThumbnailsView"
        {% endif %}
      }],
      {% if user.is_anonymous %}
        "availableAnnotationDrawingTools": [],
        "availableAnnotationStylePickers": [],
      {% endif %}
      "annotationEndpoint": { "name":"Readux", "module": "ReaduxEndpoint" }
    });
  });
</script>
{% endblock extra_javascript %}
